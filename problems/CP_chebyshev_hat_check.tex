\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{CP_chebyshev_hat_check}
  \pcomment{polished version of FP_chebyshev_hat_check with xtra part}
  \pcomment{minor revision 4/30/11 by Kazerani & ARM}
  \pcomment{revised S07 by ARM from F02.CP13w, F00, S00.ps10.5, prob 4, F01.ps12.2}
\end{pcomments}

\pkeywords{
  random_variable
  expectation
  linearity
  indicator_variable
  variance
  additivity
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
The hat-check staff has had a long day serving at a party, and at the
end of the party they simply return the $n$ checked hats in a random
way such that the probability that any particular person gets their
own hat back is $1/n$.

Let $X_i$ be the \idx{indicator variable} for the $i$th person getting
their own hat back.  Let $S_n$ be the total number of people who get
their own hat back.

\begin{problemparts}

\ppart What is the expected number of people who get their own hat back?

\examspace[0.7in]

\begin{solution}
$S_n = \sum_{i=1}^n X_i$, so by \idx{linearity of expectation},
\begin{equation}\label{esnxi}
\expect{S_n} = \sum_{i=1}^n \expect{X_i}.
\end{equation}
Since the probability a person gets their own hat back is $1/n$, therefore
$\pr{X_i=1} = 1/n$. Now, since $X_i$ is an
indicator, we have $\expect{X_i} = 1/n$.  By linearity of expectation,
\[
\expect{S_n} = \sum_{i=1}^n \expect{X_i} = n\cdot\frac{1}{n} = 1.
\]
\end{solution}

\ppart Write a simple formula for $\expect{X_i \cdot X_j}$ for $i \neq j$.

\hint What is the probability that the second person got their hat
back, given that the fifth person got their hat back, that is,
$\prcond{X_2=1}{X_5=1}$?

\examspace[0.7in]

\begin{solution}
When the fifth person gets their own hat back, the second person is
equally likely to get any one of the remaining $n-1$ hats.  So the
probability the second person gets their own hat back in this case is
$1/(n-1)$.  In other words,
\[
\prcond{X_2=1}{X_5=1} = \frac{1}{n-1}.
\]
The same reasoning implies that
\[
\prcond{X_j=1}{X_i=1} = \frac{1}{n-1},
\]
for $j \neq i$.  Therefore,
\[
\pr{X_i=1 \QAND X_j=1}
  = \prcond{X_j=1}{X_i=1}\cdot \pr{X_i=1} = \frac{1}{n-1}\frac{1}{n} = \frac{1}{n(n-1)}.
\]
But $X_i=1 \QAND X_j=1$ iff $X_i X_j = 1$, and since $X_i X_j$ is an
indicator (Bernoulli) variable, its expectation is the probability
that it equals one:
\[
\expect{X_i X_j} = \pr{X_i X_j =1} = \pr{X_i=1 \QAND X_j=1} = \frac{1}{n(n-1)}.
\]
\end{solution}

\ppart Explain why you cannot use the \idx{variance} of sums formula to
calculate $\variance{S_n}$.

\examspace[1in]

\begin{solution}
The principle of additivity of variances requires the variables
be pairwise independent, but the indicator variables for people getting
their hats back are not pairwise independent, since $\prcond{X_j=1}{X_i=1}
= 1/(n-1) \neq 1/n = \pr{X_j=1}$ for $i \neq j$.
\end{solution}

\ppart Show that $\expect{(S_n)^2} = 2$. \hint $(X_i)^2 = X_i$.

\examspace[2.0in]

\begin{solution}

\begin{align*}
\expect{S_n^2}
     & =  \Expect{\sum_{i=1}^n (X_i)^2 + 2\sum_{1 \leq i < j \leq n} X_i X_j}
           & \text{(expanding the sum for $S_n$)}\\
     & =  \sum_{i=1}^n \expect{(X_i)^2} + 2\sum_{1\leq i<j \leq n} \expect{X_i X_j}
           & \text{(linearity of $\expect{\cdot}$)}\\
     & =  \sum_{i=1}^n \expect{X_i} + 2\sum_{1\leq i<j \leq n} \frac{1}{n(n-1)}
           & \text{(since $(X_i)^2 = X_i$)}\\
     & =  n \cdot \frac{1}{n} + 2\binom{n}{2} \frac{1}{n(n-1)} \\
     & =  1+1 = 2.
\end{align*}

\end{solution}

%\examspace

\ppart What is the variance of $S_n$?

\examspace[0.7in]

\begin{solution}
\begin{equation}\label{snsn2-}
\variance{S_n} = \expect{(S_n)^2} - \expectsq{S_n} = 2 - 1^2 = 1.
\end{equation}
\end{solution}

\ppart Use the \idx{Chebyshev bound} to show that there is at most a
1\% chance that more than 10 people get their own hat back.  \iffalse
Try to give an intuitive explanation of why the chance remains this
small regardless of $n$.  \fi

%\examspace[3in]

\begin{solution}
\begin{align*}
\pr{S_n \geq 11} &= \pr{S_n - \expect{S_n} \geq 11 - \expect{S_n}} \\
                 &= \pr{S_n - \expect{S_n} \geq 10} & \text{(by~\eqref{esnxi})}\\
                 &\leq \pr{\abs{S_n - \expect{S_n}} \geq 10} \\
                 &\leq \frac{\variance{S_n}}{10^2}  & \text{(by Chebyshev)}\\
                 & = \frac{1}{100}                 & \text{(by~\eqref{snsn2-})}.
\end{align*}
\end{solution}

\end{problemparts}
\end{problem}

\endinput
