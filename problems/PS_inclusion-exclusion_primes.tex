\documentclass[problem]{mcs}

\begin{pcomments}
\pcomment{PS_inclusion-exclusion_primes}
\pcomment{from: S09:cp10r}
\pcomment{S09 was modified by ARM from S07, ps9, problem 5}
\pcomment{format edits by ARM 5/14/18}
\end{pcomments}

\pkeywords{
  counting
  counting_rules
  prime
  inclusion-exclusion
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
  How many of the numbers up to $n$ are prime?  The
  Inclusion-Exclusion Principle offers a useful way to calculate the
  answer when $n$ is large.  Actually, we will use Inclusion-Exclusion
  to count the number of \emph{composite} (nonprime) positive integers
  up to $n$.  Subtracting this from $n$ then gives the number of primes.

Let $C_n$ be the set of composite numbers in $\Zintvoc{1}{n}$, and let
$A_m$ be the set of numbers in the interval $\Zintvoc{m}{n}$ that are
divisible by $m$.  Note that $A_m \eqdef \emptyset$ for $m \geq n$, by
definition.  So
\begin{equation}\label{CU}
C_n = \lgunion_{i=2}^{n-1} A_i.
\end{equation}

\bparts

\ppart Verify that if $m \divides k$, then $A_m \supseteq A_k$.

\begin{solution}
If $a \in A_k$, then $k \divides a$ by definition of $A_k$, and therefore
$m \divides a$.  So to show that $a \in A_m$ we need only show that $a$ is
in the interval $m+1,\dots,n$.  But $a$ is in the interval $k+1,\dots,n$
by definition of $A_k$, and since $m \divides k$, we have $m+1 \leq k+1$, so
$a$ is also in the interval $m+1,\dots,n$.
\end{solution}

\ppart Explain why the right-hand side of~\eqref{CU} equals
\begin{equation}\label{LU}
\lgunion_{\text{primes } p \leq \sqrt{n}} A_p.
\end{equation}

\begin{solution}
If $m \divides k$, then $A_m \supseteq A_k$, so there is no need
  to keep $A_k$ in the right-hand side of ~\eqref{CU} as long as $A_m$
  remains in the union.  Also, any composite $\leq n$ must be
  divisible by a prime $p \leq \sqrt{n}$ (because it is a product of at
  least two primes, and they can't both be bigger than $\sqrt{n}$).  So any
  $A_k$ in the right-hand side of ~\eqref{CU} is contained in $A_p$ for
  some prime $p \leq \sqrt{n}$.
\end{solution}

\ppart\label{cam=f} Explain why $\card{A_m} = \floor{n/m} - 1$ for $m \geq 2$.

\begin{solution}
$m$ divides every $m$th integer from 1 to $n$, so $m$ divides
  $\floor{n/m}$ integers from 1 to $n$ and therefore divides one fewer
  integer from $m+1$ to $n$.
\end{solution}

\ppart\label{aaiab} Consider any two relatively prime numbers $a,b \leq n$.  What
is the one number in $(A_a \intersect A_b) - A_{ab}$?

\begin{solution}
By definition, $A_a$ is the set of numbers divisible by $a$
  in the range $a+1,\dots,n$.  Similarly, $A_b$ is the set of numbers
  divisible by $b$ in the range $b+1,\dots,n$.  Thus, $A_a \intersect
  A_b$ is the set of numbers divisible by $a$ and $b$, and hence by
  $ab$ since they are relatively prime, in the range
 $\max\set{a,b}+1,\dots,n$.  Notice that the smallest number in this set
  is $ab$.  Thus, $A_a \intersect A_b$ is the set of numbers divisible
  by $ab$ in the range $ab,\dots, n$.  In contrast, $A_{ab}$ is
  the set of numbers divisible by $ab$ in the range $ab+1,\dots,n$.
  Thus, $ab$ is the only number in $(A_a \intersect A_b) - A_{ab}$.
\end{solution}

\ppart Let $\mathcal{P}$ be a finite set of at least two primes.  Give a
simple formula for
\[
\Card{\lgintersect_{p \in \mathcal{P}} A_p}.
\]

\begin{solution}

\begin{align*}
\Card{\lgintersect_{p \in P} A_p}
    &= \Card{A_{\prod_{p \in P} p}} + 1
             & \text{part~\eqref{aaiab}}\\
    &= \paren{\floor{\frac{n}{\prod_{p \in P} p}} - 1} + 1
             & \text{by part~\eqref{cam=f}}\\
    &= \floor{\frac{n}{\prod_{p \in P} p}}.
\end{align*}

\end{solution}

\ppart Use the Inclusion-Exclusion principle to obtain a formula for
$\card{C_{150}}$ in terms the sizes of intersections among the sets
$A_2,A_3,A_5,A_7, A_{11}$.  (Omit the intersections that are empty; for
example, any intersection of more than three of these sets must be empty.)

\begin{solution}
\begin{align*}
\abs{C} =
&  \abs{A_2}+\abs{A_3}+\abs{A_5}+\abs{A_7}+\abs{A_{11}}\\
&  - \abs{A_2 \cap A_3} - \abs{A_2 \cap A_5} - \abs{A_2 \cap A_7} - \abs{A_2 \cap A_{11}}\\
&  - \abs{A_3 \cap A_5} - \abs{A_3 \cap A_7} - \abs{A_3 \cap A_{11}}\\
&  - \abs{A_5 \cap A_7} - \abs{A_5 \cap A_{11}}\\
&  - \abs{A_7 \cap A_{11}}\\
&  + \abs{A_2 \cap A_3 \cap A_5} + \abs{A_2 \cap A_3 \cap A_7} + \abs{A_2 \cap A_3 \cap A_{11}}\\
&  + \abs{A_2 \cap A_5 \cap A_7} + \abs{A_2 \cap A_5 \cap A_{11}}\\
&  +\abs{A_3 \cap A_5 \cap A_7}
\end{align*}
\end{solution}

\ppart Use this formula to find the number of primes up to 150.

\begin{solution}
We have:
\begin{align*}
\abs{C_{150}} & =
74+49+29+20+12\\
& \qquad - 25-15-10-6\\
& \qquad - 10-7-4\\
& \qquad - 4 -2\\
& \qquad - 1\\
& \qquad + 5+3+2\\
& \qquad + 2+ 1\\
& \qquad + 1\\
& = 114
\end{align*}
The number of primes from 2 to 150 is $(150-1) - \abs{C_{150}} = 149 -114= 35$.
\end{solution}

\eparts

\begin{editingnotes}
At this point it may seem that checking each number from 1 to 150 for
primality and keeping a count of primes might have been easier than using
Inclusion-Exclusion.  However, the Inclusion-Exclusion approach used here
is asymptotically faster as the range of numbers grows large.
\end{editingnotes}

\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
