\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_mod_substitution}
  \pcomment{subsumed by much cleaner PS_eval_cong_aexp}
  \pcomment{by ARM 3/7/11}
\end{pcomments}

\pkeywords{
 structural_induction
 modulo
 aexp
 substitution
 congruence
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
Prove that congruence is preserved under substitution into arithmetic
expressions.   Namely, prove that for all $e,f,g \in \aexp$ (Section~\bref{aexp_sec}), if
\begin{equation}\label{mevemfmmodn}
\meval{e}{m} \equiv \meval{f}{m} \pmod{n},
\end{equation}
then
\begin{equation}\label{evsubegm}
\meval{\msubst{e}{g}}{m} \equiv \meval{\msubst{f}{g}}{m} \pmod{n},
\end{equation}

\begin{solution}

\begin{proof}
By structural induction on the definition of $g \in \aexp$.

\textbf{base case} $(g \text{ is } \mtt{k})$: then $\msubst{e}{g} = \mtt{k} =
\msubst{f}{g}$ and~\eqref{evsubegm} follows immediately.

\textbf{base case} $(g \text{ is } x)$: then 
$\msubst{e}{g} \text{ is } e$ and $\msubst{f}{g} \text{ is } f$ and~\eqref{evsubegm}
follows immediately from~\eqref{mevemfmmodn}.

\textbf{constructor case} $(g \text{ is } \lefbrk g_1 + g_2 \rhtbrk)$: then
\begin{align*}
\meval{\msubst{e}{g}}{m}
     & = \meval{\msubst{e}{\lefbrk g_1 \sumsym g_2 \rhtbrk}}{m}
          & \text{(the current case of $g$)}\\
     & = \meval{\lefbrk \msubst{e}{g_1} \sumsym \msubst{e}{g_2} \rhtbrk}{m}
          & \text{(def of $\msubst{e}{\lefbrk g_1 \sumsym g_2 \rhtbrk}$)}\\
     & = \meval{\msubst{e}{g_1}}{m} + \meval{\msubst{e}{g_2}}{m}
          & \text{(def of $\meval{\lefbrk a + b \rhtbrk}{m}$)}\\
     & \equiv \meval{\msubst{f}{g_1}}{m} + \meval{\msubst{f}{g_2}}{m} \pmod{n}
          & \text{(by structural induction hypothesis for $g_1,g_2$}\\
     &    & \text{and because congruence is preserved under $+$,
                  Lemma~\bref{mod_congruence_lem })}\\
     & = \meval{\lefbrk \msubst{f}{g_1} \sumsym \msubst{f}{g_2} \rhtbrk}{m}
          & \text{(def of $\meval{\lefbrk a \sumsym b \rhtbrk}{m}$)}\\
     & = \meval{\msubst{f}{\lefbrk g_1 + g_2 \rhtbrk}}{m}
          & \text{(def of $\msubst{f}{\lefbrk g_1 \sumsym g_2 \rhtbrk}$)}\\
     & = \meval{\msubst{f}{g}}{m}
          & \text{(the current case of $g$)}
\end{align*}

\textbf{constructor case} $(g \text{ is } \lefbrk g_1 \prodsym  g_2 \rhtbrk)$:  similar.

\textbf{constructor case} $(g \text{ is } \minussym \lefbrk g_1 \rhtbrk)$:  similar.

\end{proof}
\end{solution}

\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
