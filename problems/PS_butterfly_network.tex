\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{from: S09.ps7}
  \pcomment{commented out in S09 - looks like it needs substantial revision}
\end{pcomments}

\pkeywords{
  networks
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
Let $B_n$ denote the butterfly network with $N=2^n$ inputs and $N$
outputs, as defined in Week 5 Notes. Show that the congestion of $B_n$ is
exactly $\sqrt{N}$ when $n$ is even.

%Let $b$ be the binary number for vertex $v$. Now, let the set of
%input vertices that can reach $v$ be $S_v$ and the set of output
%vertices reachable from $v$ be $T_v$. The set $S_v$ consists of all
%input vertices whose binary numbers match $b$ in the last $n-i$
%bits, but the first $i$ bits can be arbitrary. There are $2^i$ ways
%to set these bits, so there are $2^i$ inputs in $S_v$. The set $T_v$
%consists of all output vertices whose binary numbers match $b$ in
%the first $i$ bits, but the last $n-i$ bits can be arbitrary. There
%are $2^{n-i}$ ways to set these bits, so there are $2^{n-i}$ outputs
%in $T_v$.

\emph{Hints:}
\begin{itemize}
\item For the butterfly network, there is a unique path from
each input to each output, so the congestion is the maximum number
of messages passing through a vertex for any matching of inputs to
outputs.
\item If $v$ is a vertex at level $i$ of the butterfly
network, there is a path from exactly $2^i$ input vertices to $v$
and a path from $v$ to exactly $2^{n-i}$ output vertices.\\
\item At which level of the butterfly network must the congestion be
worst? What is the congestion at the node whose binary
representation is all $0$s at that level of the network?
\end{itemize}

\solution{
First we will show that the congestion is at most $\sqrt{N}$.

Let $v$ be an arbitrary vertex at some level $i$. Let $S_v$ be the
set of inputs that can reach vertex $v$. Let $T_v$ be the set of
outputs that are reachable from vertex $v$.

By the hint, we have $\card{S_v} = 2^i$ and $\card{T_v} = 2^{n-i}$.
The number of inputs in $S_v$ that are matched with outputs in $T_v$
is at most $\min \set{2^i,2^{n-i}}$.  To obtain an upper-bound on
the congestion of the network, we need to find the maximum value of
$\min \set{2^i,2^{n-i}}$, where the maximum is taken over all $i$.
The maximum value is achieved when $2^i$ and $2^{n-i}$ are as equal
as possible. Since $n$ is even, these two quantities are equal when
$i=n/2$, hence the maximum congestion is
\[
2^{n/2}=N^{1/2} = \sqrt{N}.
\]

Now we need to show that the congestion achieves $\sqrt{N}$
somewhere in the network. We concluded that the congestion of
$\sqrt{N}$ can be achieved only at a node at level $\frac{n}{2}$.
Consider the node at that level whose binary representation is all
$0$s. Any packet from the input in the form
$z\underbrace{0\ldots000}_{n/2\ bits}$ with destination
$\underbrace{000\ldots0}_{n/2\ bits}z'$, where $z$ and $z'$ are any
$\frac{n}{2}$-bit numbers, must pass through this node. But there
are $2^{n/2}=\sqrt{N}$ of them, giving the node load $\sqrt{N}$.
Therefore, we can conclude that the congestion of $B_n$ is exactly
$\sqrt{N}$ when $n$ is even.

%In fact, the set of vertices with load $\sqrt{N}$ are those vertices
%$v$ at level $\frac{n}{2}$ with the last $\frac{n}{2}$ bits being
%the reversal of its first $\frac{n}{2}$ bits.
%
%As a sanity check, there are a total of $\sqrt{N}\ n$-bit numbers in
%the form $kk^r$. So there are $\sqrt{N}$ vertices at level
%$\frac{n}{2}$ with load $\sqrt{N}$, giving us a total of $N$
%packets.

}
\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
