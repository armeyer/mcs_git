\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_pulverizer_machine}
  \pcomment{by ARM 2/26/11}
  \pcomment{S15.ps4}
\end{pcomments}

\pkeywords{
  pulverizer
  Euclidean
  algorithm
  state_machine
  correctness
  termination
  extended_Euclidean
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
Define the Pulverizer State machine to have:
\begin{align*}
\text{states} & \eqdef \nngint^6\\
\text{start state} & \eqdef (a, b, 0, 1, 1, 0) 
             & \text{(where $a \ge b >0$)}\\
\text{transitions} & \eqdef (x,  y,  s,  t,  u,  v) \movesto\\
     &\qquad (y,\ \rem{x}{y},\ u - sq,\ v - tq,\ s,\ t)
             & \text{(for $q = \qcnt{x}{y}, y>0$)}.
\end{align*}

\bparts

\ppart Show that the following properties are preserved invariants of
the Pulverizer machine:
\begin{align}
\gcd(x,y) & =  \gcd(a,b), \tag{Inv1}\\%XY
sa+tb & =  y,\text{ and }\tag{Inv2}\\%SaTb
ua+vb & =  x. \tag{Inv3}%uaVb
\end{align}

\begin{solution}
To verify that these are preserved invariants, suppose
\[
(x,  y,  s,  t,  u,  v) \movesto (x',  y',  s',  t',  u',  v').
\]
Note that~(Inv1) is the same one we observed for the Euclidean
algorithm.  This leaves proving that~(Inv2) and~(Inv3)
hold for the new state $x',y',s',t',u',v'$.

Now according to the procedure, $u'=s,v'=t,x'=y$, so~(Inv3) holds
for $u',v',x'$ because of~(Inv2) for $s,t,y$.  Also, 
\[
s'= u - qs,\quad t'= v - qt,\quad y' = x - qy
\]
where $q = \qcnt(x,y)$,
so
\[
s'a+t'b = (u-qs)a + (v-qt)b =ua+vb - q(sa+tb) = x - qy = y',
\]
and therefore~(Inv2) holds for $s',t',y'$.

\end{solution}

\ppart Conclude that the Pulverizer machine is partially correct.

\begin{solution}
We claim that on termination, the values of $s$ and $t$ at
termination are the desired coefficients, that is, 
\[
\gcd(a,b) = sa+tb.
\]

To prove this, we first check that all three preserved invariants are
true just before the first time around the loop.  Namely, at the
start:
\begin{align*}
x      =a, y=b,s=0, t& =1 & \mbox{so}\\
sa+tb = 0a+1b=b& =y & \mbox{confirming~(Inv2).}
\end{align*}
Also,
\begin{align*}
u     & =1, v=0, & \mbox{so} \\
ua+vb & = 1a+0b=a =x & \mbox{confirming~(Inv3)}.
\end{align*}
Now by the Invariant Principle, they are true at termination.  But at
termination, $y \divides x$ so preserved invariants~(Inv1)
and~(Inv2) imply
\[
\gcd(a,b) = \gcd(x,y) = y = sa + tb.
\]
so we have the desired coefficients $s$ and $t$.

This ingenious verification probably offers less insight than the
explanation of the Pulverizer in section~\bref{sec:pulverizer}, but it
has the virtue of being easy to check even if you don't exactly see
how it was derived from the earlier description.

It's worth thinking through how this state machine and its invariants
correspond to the Pulverizer.\iffalse
\footnote{In fact, if you're not wondering how
somebody came up with this concise program and its invariants, you:
\begin{itemize}

\item are blessed with a brilliance that makes it obvious how to derive
 this machine and its invariants from the Pulverizer,

\item have lost interest in the topic, or

\item haven't read this far.

\end{itemize}}\fi

We've already observed that a preserved invariant is really just an
induction hypothesis.  As with induction, finding the right induction
hypothesis (preserved invariant) is often the only hard part.  We
repeat:
\begin{quote}
  Given the right preserved invariant, you can routinely verify
  programs you don't understand.
\end{quote}

\end{solution}

\ppart Explain why the machine terminates after at most the same
number of transitions as the Euclidean algorithm.

\begin{solution}
Note that ${x,y}$ follows the transition rules of the Euclidean
algorithm state machine given in equation~(\bref{euclid_transition}),
except that this extended machine stops one step sooner.
\end{solution}

\eparts

\end{problem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
