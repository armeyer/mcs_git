\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{TP_sub_one_with_two_of_opposite_color}
  \pcomment{proposed for midterm II, Fall15}
  \pcomment{author: Zoran Dzunic, edited ARM}
\end{pcomments}

\pkeywords{
  state_machines
  derived_variable
  induction
  congruences
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
``Token replacing'' is a single player game using a set of tokens,
  each colored black or white.  Except for color, the tokens are
  indistinguishable.  %The game starts with one black token.
  In each move, a player can replace one black token with two
  white tokens, or replace one white token with two black tokens.

% Zoran: I somehow prefer to introduce the start state here, as it may
% be hinting too much if introduced in part (b). Also, I came up
% with another part of the problem for which it may be better to
% have the start state fixed as part of rules.

  We can model this game as a state machine whose states are pairs
  $(n_b,n_w)$ where $n_b \geq 0$ equals the number of black tokens,
  and $n_w \geq 0$ equals the number of white tokens.

\iffalse
There is no further labeling of the tokens of the same color (e.g., we
don't care which of the black tokens appeared first, second, etc.),
and the order of tokens does not matter (e.g., sequence 'bbw' is
the same as sequence 'bwb').
\fi

\bparts

\iffalse
\ppart
Model this game as a state machine, carefully defining the set of
states, the start state and the possible state transitions.
\hint Be sure to state the conditions of the state transitions.
\begin{solution}
A state of this game is fully described with a pair of nonnegative integer
numbers $(n_b, n_w)$, where $n_b$ and $n_w$ are the numbers of black and
white tokens, respectively. State transitions are of the form
$(n_b, n_w) \rightarrow (n_b-1, n_w+2)$ if $n_b > 0$, and
$(n_b, n_w) \rightarrow (n_b+2, n_w-1)$ if $n_w > 0$ 
\end{solution}

\examspace[2.0in]
\fi

\ppart
List the numbers of the following predicates that are preserved invariants:

\begin{center}
\exambox{4in}{0.5in}{0in}
\end{center}
\begin{align}
n_b + n_w  & \not\equiv 2 \pmod{3}\\
n_w - n_b  & \equiv 2 \pmod{3}\\
n_b - n_w  & \equiv 2 \pmod{3}\\
%2n_b + n_w & \equiv 2 \pmod{3}\\
n_b+n_w & > 5 \\
n_b+n_w & < 5
\end{align}

%\examspace[0.5in]

\begin{solution}
Predicates 2, 3, and 4 are preserved invariants.

Detailed explanation:
\begin{enumerate}
\item {\bf False.}  True for $(1, 0)$, but not for the state $(0, 2)$
  that it transitions to.

\item {\bf True.}
Let $(n_b, n_w)$ be an arbitrary state for which $n_w - n_b \equiv 2 \pmod{3}$.
The only two possible transitions are into state $(n'_b, n'_w) = (n_b - 1, n_w + 2)$
or state $(n'_b, n'_w) = (n_b + 2, n_w - 1)$. Note that
$n'_w - n'_b = n_w - n_b \pm 3 \equiv n_w - n_b \pmod{3} \equiv 2 \pmod{3}$,
and thus the property is preserved.

\item {\bf True.}
Similar as with predicate~(2).

\iffalse
\item {\bf True.}
Note that $2n_b + n_w = n_w - n_b + 3n_b \equiv n_w - n_b \pmod{3}$,
and thus this predicate is equivalent to predicate 2.
\fi

\item {\bf True.}
Note that $n_b + n_w$ increases by 1 at each move.  Thus, if
$n_b + n_w > 5$, the same must hold for all states it can transition to.

\item {\bf False.}
Predicate is true for state $(2, 2)$, but not for state $(1, 4)$ that
it transitions to.
\end{enumerate}
\end{solution}

\ppart Suppose the game starts with a single black token, that is,
state $(1,0)$.  List the numbers of the predicates above that are true for
all reachable states:

\begin{center}
\exambox{4in}{0.5in}{0in}
\end{center}

\begin{staffnotes}
If needed, provide the following hint.
\hint{Which are true of the start state?}
\end{staffnotes}

%\examspace[0.5in]

\begin{solution}
Predicate 2 is true for all reachable states.

Detailed explanation:
\begin{enumerate}

\item {\bf False.}
Not true for state $(0, 2)$ that is reachable:
$(1, 0) \rightarrow (0, 2)$.

\item {\bf True.}
True in the start state and is also a preserved invariant,
and is therefore true for all reachable states by the invariant principle.

\item {\bf False.}
Not true in the start state.

\iffalse
\item {\bf True.}
The same as with predicate 2.
\fi

\item {\bf False.}
Not true in the start state.

\item {\bf False.}  Note that $n_b + n_w$ increases by 1 at each move,
so it is always false after the fourth move of any kind.
\end{enumerate}

\end{solution}

\ppart
\begin{claim*}
Every state $(n_b, n_w)$ such that $n_w - n_b \equiv 2 \pmod{3}$ is reachable starting from state $(1, 0)$.
\end{claim*}
Prove the Claim \emph{by induction}.

\hint Let
\[
P(n) \eqdef \forall (n_b, n_w) \in \naturals^2.\,
 [(n_b + n_w = n) \QAND  (n_w - n_b \equiv 2 \pmod{3})]
     \QIMPLIES (n_b,n_w) \text{ is reachable}.
\]

\examspace[4.0in]

\begin{solution}
We prove the Claim by induction on $n$ with induction hypothesis $P$.

\inductioncase{Base case}: ($n = 1$). 
The only state that has $n_b + n_w = 1$ and satisfies the predicate is $(1, 0)$,
which is reachable as a start state.

\inductioncase{Base case}: ($n = 2$). 
The only possible states with $n=2$ are $(0, 2)$, $(1, 1)$ and $(2, 0)$,
out of which only $(2, 0)$ satisfied the predicate. $(0, 2)$ is reachable
from $(1, 0)$ by replacing a black token.

\inductioncase{Inductive step}:
Assume that the induction hypothesis holds for some $n \ge 2$. 
We need to show that for any state $(n_b, n_w) \in \naturals^2$
such that $n_b+n_w=n+1$ and $n_w-n_b \equiv 2 \pmod{3}$,
that state is reachable.

Let $(n_b, n_w)$ be an arbitrary such state. Then, either $n_b \ge 2$
or $n_w \ge 2$ must hold (easy to prove by contradiction).
Let us assume $n_b \ge 2$ holds.
Then, $(n'_b, n'_w) = $(n_b-2, n_w+1)$ is a valid state ($\in \naturals^2$)
and satisfies  the predicate since $n'_w- n'_b = n_w+1 - (n_b-2) = n_w - n_b + 3 \equiv 2 \pmod{3}$.
Therefore, $(n'_b, n'_w)$ is reachable by the induction hypothesis
and $(n_b, n_w)$ is reachable by a single transition from it.
Similar holds when $n_w \ge 2$.

We conclude that in any case $(n_b, n_w)$ is reachable, which completes
the induction step.

\end{solution}
%\begin{solution}
%We first observe that it is easy to check that of the four states with
%both $n_b < 2$ and $n_w < 2$, only the start state $(1,0)$ satisfies
%the condition that $n_w - n_b \equiv 2 \pmod{3}$.
%
%We now prove the Claim by induction on $n$ with induction hypothesis $P$.
%
%\begin{proof}
%\inductioncase{Base case}: ($n = 0$).  $P(0)$ holds vacuously since $0 - 0 \not\equiv 3 \pmod{3}$.
%
%\inductioncase{Inductive step}: Assume that the induction hypothesis
%holds for some $n \ge 0$.  Suppose $n_b + n_w = n+1$ and $n_w - n_b
%\equiv 2 \pmod{3}$.  We want to show that $(n_b, n_w)$ is reachable.
%
%By the observation above, $(n_b, n_w)$ is reachable if both $n_b < 2$
%and $n_w < 2$, so we need only consider the case when either $n_b
%\geq 2$ or $n_w \geq 2$.
%
%In the case that $n_b \geq 2$, we have $n_b-2 \geq 0$,
%$(n_b-2)+(n_w+1) = n$, and
%\[
%(n_b-2)-(n_w+1) = n_b-n_w -3 \equiv n_b-n_w \equiv 2 \pmod{3}.
%\]
%So by induction hypothesis $P(n)$, we have that $(n_b-2,n_w+1)$ is
%reachable.  But $(n_b-2,n_w+1)$ transitions in one step to
%$(n_b,n_w)$, so $(n_b,n_w)$ is reachable.
%
%The same argument applies in the case that $n_w \geq 2$.
%
%We conclude that in any case $(n_b,n_w)$ is reachable, which completes
%the induction step.
%
%\end{proof}
%\end{solution}

\iffalse
\ppart
For each predicate above, how would you modify the game such that
it is true for all reachable states?

%\examspace[2.0in]

\begin{solution}
\begin{enumerate}
\item Change the rules such that each token is replace with 4 tokens of opposite color instead.
\item No change.
\item Start with any state for which this predicate is satisfied, e.g., $(0, 1)$ or $(2, 0)$.
\item No change.
\item Start with any state for which $n_b + n_w > 5$, e.g., $(3, 3)$.
\item Change the rules such that each token is replace with 1 token of opposite color instead.
\end{enumerate}
\end{solution}
\fi

\eparts
\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
